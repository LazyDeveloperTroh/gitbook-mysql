---
description: >-
  여러 커넥션에서 동시에 동일한 자원에 대한 작업을 요청할 경우 순서대로 처리할 수 있도록 제어하는 역할을 하고 이를 통해 데이터의 정합성을
  보장할 수 있다.
---

# 잠금

MySQL 에서 사용되는 잠금은 크게 스토리지 엔진 레벨과 MySQL 엔진 레벨로 나눌 수 있다. MySQL 엔진은 스토리지 엔진을 제외한 나머지 부분으로 이해할 수 있으며 MySQL 엔진 레벨의 잠금은 모든 스토리지 엔진에 영향을 미치지만, 스토리지 엔진 레벨의 잠근은 스토리지 엔진 간 상호 영향을 미치지 않는 차이가 있다.



### MySQL 엔진의 잠금

#### 글로벌 락

<mark style="background-color:green;">**MySQL에서 제공하는 잠금 가운데 가장 범위가 크며 한 세션에서 글로벌 락을 획득하면 다른 세션에서 SELECT 를 제외한 대부분의 DDL 문장이나 DML 문장을 실행하는 경우 글로벌 락이 해제될 때까지 해당 문장이 대기 상태로 남는다**</mark>. 글로벌 락이 영향을 미치는 범위는 MySQL 서버 전체이며, 작업 대상 테이블이나 데이터베이스가 다르더라도 동일하게 영향을 받는다. \
\
글로벌 락은 MySQL 서버의 모든 변경 작업을 멈춘다. 하지만 <mark style="background-color:yellow;">**MySQL 8.0 에서는 조금 더 가벼운 글로벌 락의 필요성을 위해 백업 락이 도입되었다.**</mark>

* 백업  락 : 특정 세션에서 백업 락을 획득하면 모든 세션에서 데이터베이스 및 테이블 등 모든 객체 생성 및 변경, 삭제, 사용자 관리 및 비밀번호 변경 등의 작업은 불가하지만 일반적인 테이블의 데이터 변경은 허용된다.



#### 테이블 락

<mark style="background-color:green;">**테이블 락은 개별 테이블 단위로 설정되는 잠금이며, 명시적 또는 묵시적으로 특정 테이블의 락을 획득할 수 있다**</mark>. <mark style="color:red;">**묵시적인 테이블 락은 MyISAM 이나 MEMORY 테이블에 데이터를 변경하는 경우 발생한다**</mark>. <mark style="color:red;">**하지만 InnoDB 테이블의 경우 스토리지 엔진 차원에서 레코드 기반의 잠금을 제공하기 때문에 DML의  경우는 테이블 락이 설정되지 않고 DDL 의 경우에만 테이블 락이 설정된다.**</mark>



#### 네임드 락

<mark style="background-color:green;">**네임드 락은 임의의 문자열에 대해 잠금을 설정할 수 있다. 이 잠금의 특징은 대상이 테이블이나 레코드 또는 테이터베이스 객체가 아니라는 것이다**</mark>. 네임드 락은 단순히 사용자가 지정한 문자열에 대해 획득하고 반납하는 잠금이다.



#### 메타데이터 락

메타데이터 락은 데이터베이스 객체의 이름이나 구조를 변경하는 경우에 획득하는 잠금이다. 메타데이터 락은 명시적으로 획득하거나 해제할 수 있는 것이 아니고 "RENAME TABLE tab\_a TO tab\_b" 같이 테이블의 이름을 변경하는 경우 자동으로 획득하는 잠금이다.



### InnoDB 스토리지 엔진 잠금

InnoDB 스토리지 엔진은 스토리지 엔진 내부에서 레코드 기반의 잠금 방식을 탑재하고 있기 때문에 뛰어난 동시성 처리를 제공한다.&#x20;



#### 레코드 락

레코드 자체만 잠그는 것을 레코드 락이라고 한다. <mark style="background-color:green;">**InnoDB 스토리지 엔진은 레코드 자체가 아니라 인덱스의 레코드를 잠그는 특징이 있다. 인덱스가 하나도 없는 테이블이더라도 내부적으로 자동 생성된 클러스터 인덱스를 이용해 잠금을 설정한다.**</mark>



#### 갭 락

갭 락은 레코드 자체가 아니라 레코드와 바로 인접한 레코드 사이의 간격만을 잠그는 것을 의미한다. 갭 락의 역할은 레코드와 레코드 사이의 간격에 새로운 레코드가 INSERT 되는 것을 제어한다.



#### 넥스트 키 락

레코드 락과 갭 락을 합쳐 놓은 형태의 잠금을 넥스트 키 락이라고 한다. <mark style="background-color:green;">**갭 락과 넥스트 키 락은 바이너리 로그에 기록되는 쿼리가 레플리카 서버에서 실행될 때 소스 서버에서 만들어 낸 결과와 동일한 결과를 만들어내도록 보장하는 것이 주 역할이다.**</mark>



#### 자동 증가 락

MySQL 에서 자동 증가하는 숫자 값을 추출하기 위해 <mark style="background-color:green;">**AUTO\_INCREMENT 라는 칼럼 속성을 사용하는데 해당 컬럼이 사용된 테이블에 동시에 여러 레코드가 INSERT 되는 경우, 저장되는 레코드는 중복되지 않고 저장된 순서대로 증가하는 값을 가져야 한다**</mark>.  이를 위해 InnoDB 스토리지 엔진에서는 AUTO\_INCREMNET 락이라고 하는 테이블 수준의 잠금을 사용한다.\
\
AUTO\_INCREMENT 락은 INSERT와 REPLACE 쿼리 문장과 같이 새로운 레코드를 저장하는 쿼리에서만 필요하며 AUTO\_INCREMENT 값을 가져오는 순간만 락이 걸렸다가 즉시 해제된다.
